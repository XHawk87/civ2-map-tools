(this["webpackJsonpciv2-map-tools"]=this["webpackJsonpciv2-map-tools"]||[]).push([[4],{42:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return R}));var r,n=i(30),a=i.n(n),s=i(31),c=i(39),u=i(0),o=i(13),l=i(37);!function(e){e[e.DESERT=0]="DESERT",e[e.PLAINS=1]="PLAINS",e[e.GRASSLAND=2]="GRASSLAND",e[e.FOREST=3]="FOREST",e[e.HILLS=4]="HILLS",e[e.MOUNTAINS=5]="MOUNTAINS",e[e.TUNDRA=6]="TUNDRA",e[e.GLACIER=7]="GLACIER",e[e.MARSH=8]="MARSH",e[e.JUNGLE=9]="JUNGLE",e[e.WATER=10]="WATER",e[e.UNKNOWN_B=11]="UNKNOWN_B",e[e.UNKNOWN_C=12]="UNKNOWN_C",e[e.UNKNOWN_D=13]="UNKNOWN_D",e[e.UNKNOWN_E=14]="UNKNOWN_E",e[e.UNKNOWN_F=15]="UNKNOWN_F"}(r||(r={}));function h(e){return new Promise((function(t,i){var r=new Image;return r.src=e,r.onload=function(){return t(r)},r.onerror=i,r}))}var f=i(6);function v(e){var t,i,n=Object(u.useRef)(null),c=e.map,o=null!==(t=e.tileWidth)&&void 0!==t?t:16,l=null!==(i=e.tileHeight)&&void 0!==i?i:8;Object(u.useEffect)((function(){Object(s.a)(a.a.mark((function e(){var t,i,s,u,f,v,d,p,N,O,j,b,g,T,y,m,w,D,R,U,x,A,k,S,E;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.current){e.next=3;break}return e.abrupt("return");case 3:if(i=t.getContext("2d")){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,h("/civ2-map-tools/map-renderer/TERRAIN1.png");case 8:return s=e.sent,e.next=11,h("/civ2-map-tools/map-renderer/TERRAIN2.png");case 11:for(u=e.sent,i.fillStyle="#000000",i.fillRect(0,0,i.canvas.width,i.canvas.height),f=0;f<c.height;f+=1)for(v=0;v<c.width;v+=1)d=c.getTile(v,f),p=v*o+f%2*(o/2),N=f*l/2,i.drawImage(s,1,1+33*d.terrainType.valueOf(),64,32,p,N,o,l),O=c.getTile(v+f%2,f-1),j=c.getTile(v+f%2,f+1),b=c.getTile(v+f%2-1,f+1),g=c.getTile(v+f%2-1,f-1),T=(null===O||void 0===O?void 0:O.terrainType)===d.terrainType?1:0,y=(null===j||void 0===j?void 0:j.terrainType)===d.terrainType?2:0,m=(null===b||void 0===b?void 0:b.terrainType)===d.terrainType?4:0,w=(null===g||void 0===g?void 0:g.terrainType)===d.terrainType?1:0,D=1+65*(T+m+y),R=33*w,d.terrainType===r.FOREST?i.drawImage(u,D,R+133,64,32,p,N,o,l):d.terrainType===r.MOUNTAINS?i.drawImage(u,D,R+199,64,32,p,N,o,l):d.terrainType===r.HILLS&&i.drawImage(u,D,R+265,64,32,p,N,o,l),d.river&&(U=(null===O||void 0===O?void 0:O.river)||(null===O||void 0===O?void 0:O.isWater())?1:0,x=(null===j||void 0===j?void 0:j.river)||(null===j||void 0===j?void 0:j.isWater())?2:0,A=(null===b||void 0===b?void 0:b.river)||(null===b||void 0===b?void 0:b.isWater())?4:0,k=(null===g||void 0===g?void 0:g.river)||(null===g||void 0===g?void 0:g.isWater())?1:0,S=1+65*(U+A+x),E=33*k,i.drawImage(u,S,E+67,64,32,p,N,o,l));case 15:case"end":return e.stop()}}),e)})))()}),[c,l,o]);var v=(c.width+.5)*o,d=(c.height+1)*l/2;return Object(f.jsx)("section",{children:Object(f.jsx)("canvas",{ref:n,width:v,height:d})})}var d=i(35),p=i(34),N=i(32),O=i(33),j=i(38),b=function(){function e(t,i,r){Object(N.a)(this,e),this.tileData=void 0,this.x=void 0,this.y=void 0;var n=98+6*i+6*r*t.width;this.tileData=new DataView(t.mapData.buffer,n,6),this.x=i,this.y=r}return Object(O.a)(e,[{key:"terrainBits",get:function(){return this.tileData.getUint8(0)}},{key:"terrainTypeBits",get:function(){return 15&this.terrainBits}},{key:"getTerrainType",value:function(){return function(e){switch(e){case 0:return r.DESERT;case 1:return r.PLAINS;case 2:return r.GRASSLAND;case 3:return r.FOREST;case 4:return r.HILLS;case 5:return r.MOUNTAINS;case 6:return r.TUNDRA;case 7:return r.GLACIER;case 8:return r.MARSH;case 9:return r.JUNGLE;case 10:return r.WATER;case 11:return r.UNKNOWN_B;case 12:return r.UNKNOWN_C;case 13:return r.UNKNOWN_D;case 14:return r.UNKNOWN_E;case 15:return r.UNKNOWN_F;default:return r.DESERT}}(this.terrainTypeBits)}},{key:"terrainType",get:function(){return this.getTerrainType()}},{key:"isWater",value:function(){return this.terrainType===r.WATER}},{key:"isLand",value:function(){return!this.isWater()}},{key:"hasRiver",value:function(){return 128===(128&this.tileData.getUint8(0))}},{key:"river",get:function(){return this.hasRiver()}}]),e}(),g=function(e){Object(d.a)(i,e);var t=Object(p.a)(i);function i(){return Object(N.a)(this,i),t.apply(this,arguments)}return Object(O.a)(i,[{key:"terrainType",get:function(){return this.getTerrainType()},set:function(e){this.tileData.setUint8(0,(240&this.terrainBits)+(15&e.valueOf()))}},{key:"river",get:function(){return this.hasRiver()},set:function(e){e!==this.river&&this.tileData.setUint8(0,128^this.tileData.getUint8(0))}}]),i}(b),T=function(){function e(t,i){Object(N.a)(this,e),this.mapData=void 0,this.fileName=void 0,this.mapData=new DataView(t),this.fileName=i}return Object(O.a)(e,[{key:"height",get:function(){return this.mapData.getUint8(2)}},{key:"area",get:function(){return this.mapData.getUint16(4,!0)}},{key:"width",get:function(){return this.area/this.height}},{key:"isFlat",value:function(){return 1===(1&this.mapData.getUint8(6))}},{key:"isRound",value:function(){return!this.isFlat()}},{key:"flat",get:function(){return this.isFlat()}},{key:"withModifications",value:function(t){var i=new e(this.mapData.buffer.slice(0),this.fileName);return t(new y(i.mapData.buffer,i.fileName)),i}},{key:"getTile",value:function(e,t){return e<0||e>=this.width||t<0||t>=this.height?null:new b(this,e,t)}},{key:"saveAs",value:function(e){var t=this.mapData,i=t.buffer,r=t.byteLength,n=t.byteOffset,a=new Blob([new Uint8Array(i,n,r)]);Object(j.saveAs)(a,e)}}]),e}(),y=function(e){Object(d.a)(i,e);var t=Object(p.a)(i);function i(){return Object(N.a)(this,i),t.apply(this,arguments)}return Object(O.a)(i,[{key:"flat",get:function(){return this.isFlat()},set:function(e){var t=this.mapData.getUint8(6),i=e?254&t:1|t;this.mapData.setUint8(6,i)}},{key:"getTile",value:function(e,t){return new g(this,e,t)}}]),i}(T);function m(e){var t=e.map,i=Object(u.useRef)(null);return Object(f.jsxs)("div",{children:[Object(f.jsx)("input",{defaultValue:t.fileName,ref:i}),Object(f.jsx)("button",{onClick:function(){var e,r=null===(e=i.current)||void 0===e?void 0:e.value;r&&t.saveAs(r)},children:"Save"})]})}function w(e){var t=e.map,i=e.setMap;return Object(f.jsx)("button",{onClick:function(){return i(t.withModifications((function(e){for(var t=0;t<e.width;t+=1)for(var i=0;i<e.height;i+=1){var n=e.getTile(t,i);i%2===0||i===e.height-1||t===e.width-1&&e.flat?n.isWater()&&(n.terrainType=r.MOUNTAINS):n.terrainType=r.WATER}})))},children:"Convert to Waterways"})}function D(e){var t=e.map,i=e.setMap;return Object(f.jsx)("button",{onClick:function(){return i(t.withModifications((function(e){for(var t=0;t<e.width;t+=1)for(var i=0;i<e.height;i+=1){var r=e.getTile(t,i);r.isLand()&&(r.river=!0)}})))},children:"Flood with Rivers"})}function R(){var e=Object(u.useState)(null),t=Object(c.a)(e,2),i=t[0],r=t[1],n=Object(u.useRef)(null),h=function(){var e=Object(s.a)(a.a.mark((function e(t){var i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.arrayBuffer();case 2:i=e.sent,r(new T(i,t.name));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(e){var t,i=null===(t=e.target.files)||void 0===t?void 0:t.item(0);i&&h(i).finally()},p=function(e){var t,i=null===(t=e.dataTransfer)||void 0===t?void 0:t.files.item(0);i&&h(i).finally()},N=function(){var e;null===(e=n.current)||void 0===e||e.click()};return i?Object(f.jsxs)("div",{className:"App-header",children:[Object(f.jsx)(o.b,{to:"/",children:"Home"}),Object(f.jsx)("h2",{children:"Civ 2 Map Editor"}),Object(f.jsxs)(l.FileDrop,{onFrameDrop:p,onTargetClick:N,children:[Object(f.jsx)("p",{children:"Drag and drop or select a new Civ 2 Map file to change which map you are editing"}),Object(f.jsx)("div",{children:Object(f.jsx)("input",{onChange:d,ref:n,type:"file",className:"file-drop-select"})})]}),Object(f.jsx)(m,{map:i}),Object(f.jsx)(v,{map:i}),Object(f.jsxs)("div",{className:"macro-buttons",children:[Object(f.jsx)(w,{map:i,setMap:r}),Object(f.jsx)(D,{map:i,setMap:r})]})]}):Object(f.jsxs)("div",{className:"App-header",children:[Object(f.jsx)(o.b,{to:"/",children:"Home"}),Object(f.jsx)("h2",{children:"Civ 2 Map Editor"}),Object(f.jsxs)(l.FileDrop,{onFrameDrop:p,onTargetClick:N,children:[Object(f.jsx)("p",{children:"Drag and drop or select a Civ 2 Map file"}),Object(f.jsx)("div",{children:Object(f.jsx)("input",{onChange:d,ref:n,type:"file",className:"file-drop-select"})})]})]})}}}]);
//# sourceMappingURL=4.d88ad9fd.chunk.js.map
(this["webpackJsonpciv2-map-tools"]=this["webpackJsonpciv2-map-tools"]||[]).push([[5],{40:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return b}));var n,i=r(0),a=r(13),s=r(34),u=r(14),c=r.n(u),o=r(30),l=r.n(o),f=r(31);!function(e){e[e.DESERT=0]="DESERT",e[e.PLAINS=1]="PLAINS",e[e.GRASSLAND=2]="GRASSLAND",e[e.FOREST=3]="FOREST",e[e.HILLS=4]="HILLS",e[e.MOUNTAINS=5]="MOUNTAINS",e[e.TUNDRA=6]="TUNDRA",e[e.GLACIER=7]="GLACIER",e[e.MARSH=8]="MARSH",e[e.JUNGLE=9]="JUNGLE",e[e.WATER=10]="WATER",e[e.UNKNOWN_B=11]="UNKNOWN_B",e[e.UNKNOWN_C=12]="UNKNOWN_C",e[e.UNKNOWN_D=13]="UNKNOWN_D",e[e.UNKNOWN_E=14]="UNKNOWN_E",e[e.UNKNOWN_F=15]="UNKNOWN_F"}(n||(n={}));function d(e){return new Promise((function(t,r){var n=new Image;return n.src=e,n.onload=function(){return t(n)},n.onerror=r,n}))}var v=r(6);function h(e){var t,r,a=Object(i.useRef)(null),s=e.mapData,u=null!==(t=e.tileWidth)&&void 0!==t?t:16,c=null!==(r=e.tileHeight)&&void 0!==r?r:8;Object(i.useEffect)((function(){Object(f.a)(l.a.mark((function e(){var t,r,i,o,f,v,h,p,N,O,T,g,y,m,D,b,j,U,A,w,R,E,S,W,I;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.current){e.next=3;break}return e.abrupt("return");case 3:if(r=t.getContext("2d")){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,d("/map-renderer/TERRAIN1.png");case 8:return i=e.sent,e.next=11,d("/map-renderer/TERRAIN2.png");case 11:for(o=e.sent,r.fillStyle="#000000",r.fillRect(0,0,r.canvas.width,r.canvas.height),f=0;f<s.height;f+=1)for(v=0;v<s.width;v+=1)h=s.getTile(v,f),p=v*u+f%2*(u/2),N=f*c/2,r.drawImage(i,1,1+33*h.terrainType.valueOf(),64,32,p,N,u,c),O=s.getTile(v+f%2,f-1),T=s.getTile(v+f%2,f+1),g=s.getTile(v+f%2-1,f+1),y=s.getTile(v+f%2-1,f-1),m=(null===O||void 0===O?void 0:O.terrainType)===h.terrainType?1:0,D=(null===T||void 0===T?void 0:T.terrainType)===h.terrainType?2:0,b=(null===g||void 0===g?void 0:g.terrainType)===h.terrainType?4:0,j=(null===y||void 0===y?void 0:y.terrainType)===h.terrainType?1:0,U=1+65*(m+b+D),A=33*j,h.terrainType===n.FOREST?r.drawImage(o,U,A+133,64,32,p,N,u,c):h.terrainType===n.MOUNTAINS?r.drawImage(o,U,A+199,64,32,p,N,u,c):h.terrainType===n.HILLS&&r.drawImage(o,U,A+265,64,32,p,N,u,c),h.river&&(w=(null===O||void 0===O?void 0:O.river)||(null===O||void 0===O?void 0:O.isWater())?1:0,R=(null===T||void 0===T?void 0:T.river)||(null===T||void 0===T?void 0:T.isWater())?2:0,E=(null===g||void 0===g?void 0:g.river)||(null===g||void 0===g?void 0:g.isWater())?4:0,S=(null===y||void 0===y?void 0:y.river)||(null===y||void 0===y?void 0:y.isWater())?1:0,W=1+65*(w+E+R),I=33*S,r.drawImage(o,W,I+67,64,32,p,N,u,c));case 15:case"end":return e.stop()}}),e)})))().finally()}),[s,c,u]);var o=(s.width+.5)*u,h=(s.height+1)*c/2;return Object(v.jsx)("section",{children:Object(v.jsx)("canvas",{ref:a,width:o,height:h})})}var p=r(32),N=r(33),O=r(36),T=function(){function e(t,r,n){Object(p.a)(this,e),this.tileData=void 0;var i=98+6*r+6*n*t.width;this.tileData=new DataView(t.buffer,i,6)}return Object(N.a)(e,[{key:"terrainBits",get:function(){return this.tileData.getUint8(0)}},{key:"terrainTypeBits",get:function(){return 15&this.terrainBits}},{key:"terrainType",get:function(){return function(e){switch(e){case 0:return n.DESERT;case 1:return n.PLAINS;case 2:return n.GRASSLAND;case 3:return n.FOREST;case 4:return n.HILLS;case 5:return n.MOUNTAINS;case 6:return n.TUNDRA;case 7:return n.GLACIER;case 8:return n.MARSH;case 9:return n.JUNGLE;case 10:return n.WATER;case 11:return n.UNKNOWN_B;case 12:return n.UNKNOWN_C;case 13:return n.UNKNOWN_D;case 14:return n.UNKNOWN_E;case 15:return n.UNKNOWN_F;default:return n.DESERT}}(this.terrainTypeBits)},set:function(e){this.tileData.setUint8(0,(240&this.terrainBits)+(15&e.valueOf()))}},{key:"isWater",value:function(){return this.terrainType===n.WATER}},{key:"river",get:function(){return 128===(128&this.tileData.getUint8(0))},set:function(e){e!==this.river&&this.tileData.setUint8(0,128^this.tileData.getUint8(0))}},{key:"copyTile",value:function(e){for(var t=0;t<this.tileData.byteLength;t+=1)this.tileData.setUint8(t,e.tileData.getUint8(t))}}]),e}(),g=r(37),y=r.n(g),m=function(){function e(t,r){Object(p.a)(this,e),this.mapData=void 0,this.fileName=void 0,this.mapData=new DataView(t),this.fileName=null!==r&&void 0!==r?r:y()(Date.now(),"yyyy-mm-dd_HH-MM-ss")+".mp"}return Object(N.a)(e,[{key:"buffer",get:function(){return this.mapData.buffer}},{key:"height",get:function(){return this.mapData.getUint8(2)}},{key:"area",get:function(){return this.mapData.getUint16(4,!0)}},{key:"width",get:function(){return this.area/this.height}},{key:"flat",get:function(){return 1===(1&this.mapData.getUint8(6))},set:function(e){e!==this.flat&&this.mapData.setUint8(6,1^this.mapData.getUint8(6))}},{key:"isRound",value:function(){return!this.flat}},{key:"getTile",value:function(e,t){return e<0||e>=this.width||t<0||t>=this.height?null:new T(this,e,t)}},{key:"copy",value:function(){return new e(this.mapData.buffer.slice(0))}},{key:"saveAs",value:function(e){var t=new Blob([new Uint8Array(this.mapData.buffer,this.mapData.byteOffset,this.mapData.byteLength)]);Object(O.saveAs)(t,e)}}]),e}();function D(e){var t=e.mapData,r=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.saveAs(t.fileName);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(v.jsx)("div",{children:Object(v.jsx)("button",{onClick:r,children:"Save"})})}function b(){var e=Object(i.useRef)(null),t=function(e){e&&e.arrayBuffer().then((function(t){for(var r=e.name.replace(/\..*?^/,"")+"-WATERWAYS.MP",i=new m(t,r),a=0;a<i.width;a+=1)for(var s=0;s<i.height;s+=1){var u=i.getTile(a,s);s%2===0||s===i.height-1||a===i.width-1&&i.flat?u.isWater()&&(u.terrainType=n.MOUNTAINS):u.terrainType=n.WATER}c.a.render(Object(v.jsx)(h,{mapData:i}),document.getElementById("map-renderer-container")),c.a.render(Object(v.jsx)(D,{mapData:i}),document.getElementById("map-saver-container"))}))};return Object(v.jsxs)("div",{className:"App-header",children:[Object(v.jsx)(a.b,{to:"/",children:"Home"}),Object(v.jsx)("h2",{children:"Convert Map to Waterways"}),Object(v.jsxs)(s.FileDrop,{onFrameDrop:function(e){var r;t(null===(r=e.dataTransfer)||void 0===r?void 0:r.files.item(0))},onTargetClick:function(){var t;null===(t=e.current)||void 0===t||t.click()},children:[Object(v.jsx)("p",{children:"Drag and drop or select a Civ 2 Map file"}),Object(v.jsxs)("div",{children:[Object(v.jsx)("input",{onChange:function(e){var r;t(null===(r=e.target.files)||void 0===r?void 0:r.item(0))},ref:e,type:"file",className:"file-drop-select"}),Object(v.jsx)("div",{id:"map-saver-container"})]})]}),Object(v.jsx)("div",{id:"map-renderer-container"})]})}}}]);
//# sourceMappingURL=5.26de3467.chunk.js.map